# 運用設計

## 環境設定

### 設定ファイル

- `application.yml`：データベース接続情報、外部API設定、ログレベル設定
- `environment.config`：環境変数（開発/ステージング/本番の切り替え）

### 環境別設定

| 環境 | データベース | 外部API |
|------|-------------|---------|
| 開発 | localhost:5432 | テスト用エンドポイント |
| ステージング | staging-db.example.com | ステージング用エンドポイント |
| 本番 | prod-db.example.com | 本番用エンドポイント |

### 切り替え方針

環境変数 `APP_ENV` の値（development / staging / production）により、対応する設定ファイルを自動的に読み込む。

## ログ設計

### ログ種別

- **操作ログ**：ユーザーの操作履歴（ログイン、データ登録・更新・削除）
- **エラーログ**：システムエラー、例外情報、スタックトレース
- **アクセスログ**：HTTPリクエスト情報（URL、メソッド、ステータスコード、応答時間）

### ログ出力項目

| 項目 | 内容 |
|------|------|
| タイムスタンプ | YYYY-MM-DD HH:MM:SS.mmm形式 |
| ログレベル | DEBUG / INFO / WARN / ERROR |
| ユーザーID | 操作ユーザーのID（未ログイン時は"anonymous"） |
| 操作内容 | 実行した機能・アクション |
| IPアドレス | クライアントのIPアドレス |
| メッセージ | 詳細メッセージまたはエラー内容 |

### 保管場所・ローテーション

- ログファイル：`/var/log/customer-system/app.log`
- ローテーション：日次、30日分保管
- バックアップ：圧縮後、別サーバーへ転送
