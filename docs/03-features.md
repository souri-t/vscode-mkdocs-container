# 機能設計

## 機能一覧

| 機能ID | 機能名 | 概要 |
|--------|--------|------|
| F001 | 顧客情報登録 | 新規顧客情報を登録する |
| F002 | 顧客情報検索 | 顧客名、会社名、担当者などで顧客を検索する |
| F003 | 顧客情報更新 | 既存の顧客情報を更新する |
| F004 | 商談履歴管理 | 商談の記録と履歴を管理する |
| F005 | 見積作成 | 顧客向けの見積書を作成・PDF出力する |
| F006 | レポート出力 | 営業実績をグラフ・表で可視化する |
| F007 | ユーザー管理 | システム利用者の登録・権限設定を行う |

## 機能構成図

```plantuml
@startuml
package "顧客管理機能" {
  [顧客情報登録]
  [顧客情報検索]
  [顧客情報更新]
}

package "営業支援機能" {
  [商談履歴管理]
  [見積作成]
  [レポート出力]
}

package "システム管理機能" {
  [ユーザー管理]
}

[顧客情報登録] --> [顧客情報検索]
[顧客情報検索] --> [商談履歴管理]
[商談履歴管理] --> [見積作成]
@enduml
```

## 機能詳細仕様

### F001：顧客情報登録

- **入力条件**：顧客名（必須）、会社名、電話番号、メールアドレス、住所、担当者名
- **出力結果**：登録完了メッセージ、顧客ID自動採番
- **処理概要**：
  - 入力値のバリデーション（必須チェック、形式チェック）
  - 重複チェック（同一メールアドレスの顧客が存在しないか確認）
  - データベースへの登録
  - 登録完了通知

- **処理シーケンス**：

```plantuml
@startuml
actor ユーザー
participant "画面\n（フロントエンド）" as UI
participant "APIサーバー" as API
participant "データベース" as DB

ユーザー -> UI: 顧客情報入力
ユーザー -> UI: 登録ボタンクリック
UI -> UI: 入力値検証
alt 検証エラー
    UI -> ユーザー: エラーメッセージ表示
else 検証OK
    UI -> API: POST /api/customers\n顧客情報送信
    API -> API: バリデーション
    API -> DB: SELECT\nメールアドレス重複チェック
    DB --> API: 検索結果
    alt 重複あり
        API --> UI: 409 Conflict\nエラーレスポンス
        UI -> ユーザー: 重複エラー表示
    else 重複なし
        API -> DB: INSERT\n顧客情報登録
        DB --> API: 登録成功\n顧客ID採番
        API --> UI: 200 OK\n登録完了
        UI -> ユーザー: 登録完了メッセージ表示
        UI -> UI: 顧客一覧画面へ遷移
    end
end
@enduml
```

### F002：顧客情報検索

- **入力条件**：顧客名、会社名、担当者名（部分一致可）、登録日範囲
- **出力結果**：検索結果一覧（最大100件）
- **処理概要**：
  - 検索条件に基づくデータベース検索
  - 結果の一覧表示（ページネーション対応）
  - 詳細画面への遷移リンク提供
